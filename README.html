

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Zeek Package for Log Filter &mdash; zkg: Windows Version Detection source documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="&lt;no title&gt;" href="scripts/index.html" />
    <link rel="prev" title="Zeek Package Documentation: Log Filter" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> zkg: Windows Version Detection
          

          
          </a>

          
            
            
              <div class="version">
                source
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Zeek Package for Log Filter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-and-unloading">Updating and Unloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-filters">Writing Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#package-template">Package Template</a></li>
<li class="toctree-l2"><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scripts/main.zeek.html">main.zeek</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scripts/main.zeek.html#summary">Summary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="scripts/main.zeek.html#events">Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts/main.zeek.html#hooks">Hooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="scripts/main.zeek.html#detailed-interface">Detailed Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="scripts/main.zeek.html#id1">Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripts/main.zeek.html#id2">Hooks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripts/__load__.zeek.html">__load__.zeek</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scripts/__load__.zeek.html#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts/__load__.zeek.html#detailed-interface">Detailed Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripts/local/__load__.zeek.html">local/__load__.zeek</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scripts/local/__load__.zeek.html#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts/local/__load__.zeek.html#detailed-interface">Detailed Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="genindex.html">Index</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">zkg: Windows Version Detection</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Zeek Package for Log Filter</li>
    
    
<li class="wy-breadcrumbs-aside">

  
    <a href="_sources/README.rst.txt" rel="nofollow"> View page source</a>
  

</li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="zeek-package-for-log-filter">
<h1>Zeek Package for Log Filter<a class="headerlink" href="#zeek-package-for-log-filter" title="Permalink to this headline">¶</a></h1>
<a class="reference external image-reference" href="https://github.com/esnet-security/logfilter/actions?query=workflow%3A%22Zeek+master%22"><img alt="Zeek master Test Status" src="https://img.shields.io/github/workflow/status/esnet-security/logfilter/Zeek%20master?label=master&amp;logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMS4zNyAyMy4yNyI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOiNmZmY7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTYuMjYsMTEuMzVhLjcuNywwLDAsMS0uNDYtLjE4bC01LjU4LTVBLjY5LjY5LDAsMCwxLDAsNS43YS43Mi43MiwwLDAsMSwuMTgtLjQ5bDAsMCwuMDUsMGgwbDUuNTQtNUEuNy43LDAsMCwxLDYuMjcsMGEuNi42LDAsMCwxLC4yNy4wNkEuNjcuNjcsMCwwLDEsNywuNjhMNi42OSwyLjkxSDE5LjgzYS42Ny42NywwLDAsMSwuNjEuMzkuNjguNjgsMCwwLDEtLjA4LjcxbC0xLjg0LDIuM2EuNjUuNjUsMCwwLDEtLjUyLjI1LjY4LjY4LDAsMCwxLS42OC0uNi42NS42NSwwLDAsMSwuMTUtLjVsMS0xLjE5SDZhLjY4LjY4LDAsMCwxLS42Ny0uNjhsLjE4LTEuMjdMMS42OCw1LjY4LDUuNDcsOSw1LjI5LDcuOEEuNjguNjgsMCwwLDEsNiw3LjA4bDEuMzYtLjE1LDAsLjYtLjExLS40Mi4wNi40M2EuMjEuMjEsMCwwLDAtLjE4LjIxQS4yMi4yMiwwLDAsMCw3LjMzLDh2LjFsMCwuNS0uNjItLjA2LjI2LDIuMTNhLjY4LjY4LDAsMCwxLS40MS42NUEuNjYuNjYsMCwwLDEsNi4yNiwxMS4zNVoiLz48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik0xNS4wOSwyMy4yN2EuNTguNTgsMCwwLDEtLjI2LS4wNi42OC42OCwwLDAsMS0uNDEtLjYybC4yNi0yLjI0SDEuNTRBLjcxLjcxLDAsMCwxLC45MiwyMCwuNjkuNjksMCwwLDEsMSwxOS4yNUwyLjg0LDE3YS42Ny42NywwLDAsMSwuNTMtLjI1LjcxLjcxLDAsMCwxLC40Mi4xNC42Ny42NywwLDAsMSwuMjUuNDYuNjkuNjksMCwwLDEtLjE0LjVMMywxOUgxNS4zOWEuNjcuNjcsMCwwLDEsLjY4LjY3TDE1Ljg5LDIxbDMuNzktMy4zN0wxNS45LDE0LjI0bC4xOCwxLjIyYS42OC42OCwwLDAsMS0uNjcuNzJMMTQsMTYuMzRsMC0uNjFoLjA3YS4yMy4yMywwLDAsMCwuMTctLjIyQS4yMi4yMiwwLDAsMCwxNCwxNS4zaDBsMC0uNnYuNWwuMDYtLjQ5LjU5LjA1LS4yNi0yLjEyYS42OS42OSwwLDAsMSwuNDEtLjY2LjU5LjU5LDAsMCwxLC4yNy0uMDUuNjcuNjcsMCwwLDEsLjQ2LjE4bDUuNTgsNWEuNjkuNjksMCwwLDEsLjIyLjQ4LjY2LjY2LDAsMCwxLS4xOS40OGwwLDAsMCwwLTUuNTUsNUEuNjguNjgsMCwwLDEsMTUuMDksMjMuMjdaIi8+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNy4yMSwxNi4zNGEuODMuODMsMCwwLDEtLjc1LS40OEEuODEuODEsMCwwLDEsNi41OCwxNUwxMiw4LjU4SDcuMzJsLS4wNiwwYS44MS44MSwwLDAsMS0uNzMtLjgxLjgyLjgyLDAsMCwxLC43OS0uODJoNi41MWEuODMuODMsMCwwLDEsLjYzLDEuMzZMOSwxNC42OWg1YS44My44MywwLDAsMSwwLDEuNjVINy4yMVoiLz48L3N2Zz4=" /></a>
<a class="reference external image-reference" href="https://esnet-security.github.io/logfilter/"><img alt="Documentation Status" src="https://img.shields.io/github/workflow/status/esnet-security/logfilter/Documentation?label=Docs&amp;logo=read-the-docs" /></a>
<a class="reference external image-reference" href="https://coveralls.io/github/esnet-security/logfilter?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/esnet-security/logfilter/badge.svg?branch=master" /></a>
<a class="reference external image-reference" href="https://github.com/esnet-security/logfilter/actions?query=workflow%3ACruft"><img alt="Template Status" src="https://img.shields.io/github/workflow/status/esnet-security/logfilter/Cruft?label=Latest%20Template" /></a>
<p>Enables plugins to write fine-grained policy for log filtering, modification, and path customization.</p>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>If you already have Zeek and <code class="docutils literal notranslate"><span class="pre">zkg</span></code> installed, simply run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zkg install https://github.com/esnet-security/logfilter</span>
</pre></div>
</div>
<p>If this is being installed on a cluster, install the package on the manager, then deploy it via:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zeekctl deploy</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-and-unloading">
<h2>Updating and Unloading<a class="headerlink" href="#updating-and-unloading" title="Permalink to this headline">¶</a></h2>
<p>We use <a class="reference external" href="http://semver.org/">SemVer</a> for versioning. For the versions
available, see the <a class="reference external" href="../../tags">tags on this repository</a>. You can
pass an additional argument to the <code class="docutils literal notranslate"><span class="pre">install</span></code> command with the desired
version.</p>
<p>To upgrade to the latest version run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zkg upgrade logfilter</span>
</pre></div>
</div>
<p>You can modify the above command by replacing <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> with:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">unload</span></code>, to configure Zeek to not load the package on startup.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">load</span></code>, to configure Zeek to load the package on startup (default after an install).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remove</span></code>, to delete the package from the system.</p></li>
</ul>
<p>If you’re operating in a cluster, after performing any of the above changes, you’ll need to re-run <code class="docutils literal notranslate"><span class="pre">zeekctl</span> <span class="pre">deploy</span></code>.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<a class="reference external image-reference" href="https://github.com/esnet-security/logfilter/actions?query=workflow%3A%22Zeek+3.3%22"><img alt="Zeek v3.3 Test Status" src="https://img.shields.io/github/workflow/status/esnet-security/logfilter/Zeek%203.3?label=v3.3&amp;logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMS4zNyAyMy4yNyI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOiNmZmY7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTYuMjYsMTEuMzVhLjcuNywwLDAsMS0uNDYtLjE4bC01LjU4LTVBLjY5LjY5LDAsMCwxLDAsNS43YS43Mi43MiwwLDAsMSwuMTgtLjQ5bDAsMCwuMDUsMGgwbDUuNTQtNUEuNy43LDAsMCwxLDYuMjcsMGEuNi42LDAsMCwxLC4yNy4wNkEuNjcuNjcsMCwwLDEsNywuNjhMNi42OSwyLjkxSDE5LjgzYS42Ny42NywwLDAsMSwuNjEuMzkuNjguNjgsMCwwLDEtLjA4LjcxbC0xLjg0LDIuM2EuNjUuNjUsMCwwLDEtLjUyLjI1LjY4LjY4LDAsMCwxLS42OC0uNi42NS42NSwwLDAsMSwuMTUtLjVsMS0xLjE5SDZhLjY4LjY4LDAsMCwxLS42Ny0uNjhsLjE4LTEuMjdMMS42OCw1LjY4LDUuNDcsOSw1LjI5LDcuOEEuNjguNjgsMCwwLDEsNiw3LjA4bDEuMzYtLjE1LDAsLjYtLjExLS40Mi4wNi40M2EuMjEuMjEsMCwwLDAtLjE4LjIxQS4yMi4yMiwwLDAsMCw3LjMzLDh2LjFsMCwuNS0uNjItLjA2LjI2LDIuMTNhLjY4LjY4LDAsMCwxLS40MS42NUEuNjYuNjYsMCwwLDEsNi4yNiwxMS4zNVoiLz48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik0xNS4wOSwyMy4yN2EuNTguNTgsMCwwLDEtLjI2LS4wNi42OC42OCwwLDAsMS0uNDEtLjYybC4yNi0yLjI0SDEuNTRBLjcxLjcxLDAsMCwxLC45MiwyMCwuNjkuNjksMCwwLDEsMSwxOS4yNUwyLjg0LDE3YS42Ny42NywwLDAsMSwuNTMtLjI1LjcxLjcxLDAsMCwxLC40Mi4xNC42Ny42NywwLDAsMSwuMjUuNDYuNjkuNjksMCwwLDEtLjE0LjVMMywxOUgxNS4zOWEuNjcuNjcsMCwwLDEsLjY4LjY3TDE1Ljg5LDIxbDMuNzktMy4zN0wxNS45LDE0LjI0bC4xOCwxLjIyYS42OC42OCwwLDAsMS0uNjcuNzJMMTQsMTYuMzRsMC0uNjFoLjA3YS4yMy4yMywwLDAsMCwuMTctLjIyQS4yMi4yMiwwLDAsMCwxNCwxNS4zaDBsMC0uNnYuNWwuMDYtLjQ5LjU5LjA1LS4yNi0yLjEyYS42OS42OSwwLDAsMSwuNDEtLjY2LjU5LjU5LDAsMCwxLC4yNy0uMDUuNjcuNjcsMCwwLDEsLjQ2LjE4bDUuNTgsNWEuNjkuNjksMCwwLDEsLjIyLjQ4LjY2LjY2LDAsMCwxLS4xOS40OGwwLDAsMCwwLTUuNTUsNUEuNjguNjgsMCwwLDEsMTUuMDksMjMuMjdaIi8+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNy4yMSwxNi4zNGEuODMuODMsMCwwLDEtLjc1LS40OEEuODEuODEsMCwwLDEsNi41OCwxNUwxMiw4LjU4SDcuMzJsLS4wNiwwYS44MS44MSwwLDAsMS0uNzMtLjgxLjgyLjgyLDAsMCwxLC43OS0uODJoNi41MWEuODMuODMsMCwwLDEsLjYzLDEuMzZMOSwxNC42OWg1YS44My44MywwLDAsMSwwLDEuNjVINy4yMVoiLz48L3N2Zz4=" /></a>
<a class="reference external image-reference" href="https://github.com/esnet-security/logfilter/actions?query=workflow%3A%22Zeek+3.2%22"><img alt="Zeek v3.2 Test Status" src="https://img.shields.io/github/workflow/status/esnet-security/logfilter/Zeek%203.2?label=v3.2&amp;logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMS4zNyAyMy4yNyI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOiNmZmY7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTYuMjYsMTEuMzVhLjcuNywwLDAsMS0uNDYtLjE4bC01LjU4LTVBLjY5LjY5LDAsMCwxLDAsNS43YS43Mi43MiwwLDAsMSwuMTgtLjQ5bDAsMCwuMDUsMGgwbDUuNTQtNUEuNy43LDAsMCwxLDYuMjcsMGEuNi42LDAsMCwxLC4yNy4wNkEuNjcuNjcsMCwwLDEsNywuNjhMNi42OSwyLjkxSDE5LjgzYS42Ny42NywwLDAsMSwuNjEuMzkuNjguNjgsMCwwLDEtLjA4LjcxbC0xLjg0LDIuM2EuNjUuNjUsMCwwLDEtLjUyLjI1LjY4LjY4LDAsMCwxLS42OC0uNi42NS42NSwwLDAsMSwuMTUtLjVsMS0xLjE5SDZhLjY4LjY4LDAsMCwxLS42Ny0uNjhsLjE4LTEuMjdMMS42OCw1LjY4LDUuNDcsOSw1LjI5LDcuOEEuNjguNjgsMCwwLDEsNiw3LjA4bDEuMzYtLjE1LDAsLjYtLjExLS40Mi4wNi40M2EuMjEuMjEsMCwwLDAtLjE4LjIxQS4yMi4yMiwwLDAsMCw3LjMzLDh2LjFsMCwuNS0uNjItLjA2LjI2LDIuMTNhLjY4LjY4LDAsMCwxLS40MS42NUEuNjYuNjYsMCwwLDEsNi4yNiwxMS4zNVoiLz48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik0xNS4wOSwyMy4yN2EuNTguNTgsMCwwLDEtLjI2LS4wNi42OC42OCwwLDAsMS0uNDEtLjYybC4yNi0yLjI0SDEuNTRBLjcxLjcxLDAsMCwxLC45MiwyMCwuNjkuNjksMCwwLDEsMSwxOS4yNUwyLjg0LDE3YS42Ny42NywwLDAsMSwuNTMtLjI1LjcxLjcxLDAsMCwxLC40Mi4xNC42Ny42NywwLDAsMSwuMjUuNDYuNjkuNjksMCwwLDEtLjE0LjVMMywxOUgxNS4zOWEuNjcuNjcsMCwwLDEsLjY4LjY3TDE1Ljg5LDIxbDMuNzktMy4zN0wxNS45LDE0LjI0bC4xOCwxLjIyYS42OC42OCwwLDAsMS0uNjcuNzJMMTQsMTYuMzRsMC0uNjFoLjA3YS4yMy4yMywwLDAsMCwuMTctLjIyQS4yMi4yMiwwLDAsMCwxNCwxNS4zaDBsMC0uNnYuNWwuMDYtLjQ5LjU5LjA1LS4yNi0yLjEyYS42OS42OSwwLDAsMSwuNDEtLjY2LjU5LjU5LDAsMCwxLC4yNy0uMDUuNjcuNjcsMCwwLDEsLjQ2LjE4bDUuNTgsNWEuNjkuNjksMCwwLDEsLjIyLjQ4LjY2LjY2LDAsMCwxLS4xOS40OGwwLDAsMCwwLTUuNTUsNUEuNjguNjgsMCwwLDEsMTUuMDksMjMuMjdaIi8+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNy4yMSwxNi4zNGEuODMuODMsMCwwLDEtLjc1LS40OEEuODEuODEsMCwwLDEsNi41OCwxNUwxMiw4LjU4SDcuMzJsLS4wNiwwYS44MS44MSwwLDAsMS0uNzMtLjgxLjgyLjgyLDAsMCwxLC43OS0uODJoNi41MWEuODMuODMsMCwwLDEsLjYzLDEuMzZMOSwxNC42OWg1YS44My44MywwLDAsMSwwLDEuNjVINy4yMVoiLz48L3N2Zz4=" /></a>
<a class="reference external image-reference" href="https://github.com/esnet-security/logfilter/actions?query=workflow%3A%22Zeek+3.1%22"><img alt="Zeek v3.1 Test Status" src="https://img.shields.io/github/workflow/status/esnet-security/logfilter/Zeek%203.1?label=v3.1&amp;logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMS4zNyAyMy4yNyI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOiNmZmY7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTYuMjYsMTEuMzVhLjcuNywwLDAsMS0uNDYtLjE4bC01LjU4LTVBLjY5LjY5LDAsMCwxLDAsNS43YS43Mi43MiwwLDAsMSwuMTgtLjQ5bDAsMCwuMDUsMGgwbDUuNTQtNUEuNy43LDAsMCwxLDYuMjcsMGEuNi42LDAsMCwxLC4yNy4wNkEuNjcuNjcsMCwwLDEsNywuNjhMNi42OSwyLjkxSDE5LjgzYS42Ny42NywwLDAsMSwuNjEuMzkuNjguNjgsMCwwLDEtLjA4LjcxbC0xLjg0LDIuM2EuNjUuNjUsMCwwLDEtLjUyLjI1LjY4LjY4LDAsMCwxLS42OC0uNi42NS42NSwwLDAsMSwuMTUtLjVsMS0xLjE5SDZhLjY4LjY4LDAsMCwxLS42Ny0uNjhsLjE4LTEuMjdMMS42OCw1LjY4LDUuNDcsOSw1LjI5LDcuOEEuNjguNjgsMCwwLDEsNiw3LjA4bDEuMzYtLjE1LDAsLjYtLjExLS40Mi4wNi40M2EuMjEuMjEsMCwwLDAtLjE4LjIxQS4yMi4yMiwwLDAsMCw3LjMzLDh2LjFsMCwuNS0uNjItLjA2LjI2LDIuMTNhLjY4LjY4LDAsMCwxLS40MS42NUEuNjYuNjYsMCwwLDEsNi4yNiwxMS4zNVoiLz48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik0xNS4wOSwyMy4yN2EuNTguNTgsMCwwLDEtLjI2LS4wNi42OC42OCwwLDAsMS0uNDEtLjYybC4yNi0yLjI0SDEuNTRBLjcxLjcxLDAsMCwxLC45MiwyMCwuNjkuNjksMCwwLDEsMSwxOS4yNUwyLjg0LDE3YS42Ny42NywwLDAsMSwuNTMtLjI1LjcxLjcxLDAsMCwxLC40Mi4xNC42Ny42NywwLDAsMSwuMjUuNDYuNjkuNjksMCwwLDEtLjE0LjVMMywxOUgxNS4zOWEuNjcuNjcsMCwwLDEsLjY4LjY3TDE1Ljg5LDIxbDMuNzktMy4zN0wxNS45LDE0LjI0bC4xOCwxLjIyYS42OC42OCwwLDAsMS0uNjcuNzJMMTQsMTYuMzRsMC0uNjFoLjA3YS4yMy4yMywwLDAsMCwuMTctLjIyQS4yMi4yMiwwLDAsMCwxNCwxNS4zaDBsMC0uNnYuNWwuMDYtLjQ5LjU5LjA1LS4yNi0yLjEyYS42OS42OSwwLDAsMSwuNDEtLjY2LjU5LjU5LDAsMCwxLC4yNy0uMDUuNjcuNjcsMCwwLDEsLjQ2LjE4bDUuNTgsNWEuNjkuNjksMCwwLDEsLjIyLjQ4LjY2LjY2LDAsMCwxLS4xOS40OGwwLDAsMCwwLTUuNTUsNUEuNjguNjgsMCwwLDEsMTUuMDksMjMuMjdaIi8+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNy4yMSwxNi4zNGEuODMuODMsMCwwLDEtLjc1LS40OEEuODEuODEsMCwwLDEsNi41OCwxNUwxMiw4LjU4SDcuMzJsLS4wNiwwYS44MS44MSwwLDAsMS0uNzMtLjgxLjgyLjgyLDAsMCwxLC43OS0uODJoNi41MWEuODMuODMsMCwwLDEsLjYzLDEuMzZMOSwxNC42OWg1YS44My44MywwLDAsMSwwLDEuNjVINy4yMVoiLz48L3N2Zz4=" /></a>
<a class="reference external image-reference" href="https://github.com/esnet-security/logfilter/actions?query=workflow%3A%22Zeek+3.0%22"><img alt="Zeek v3.0 Test Status" src="https://img.shields.io/github/workflow/status/esnet-security/logfilter/Zeek%203.0?label=v3.0&amp;logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMS4zNyAyMy4yNyI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOiNmZmY7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTYuMjYsMTEuMzVhLjcuNywwLDAsMS0uNDYtLjE4bC01LjU4LTVBLjY5LjY5LDAsMCwxLDAsNS43YS43Mi43MiwwLDAsMSwuMTgtLjQ5bDAsMCwuMDUsMGgwbDUuNTQtNUEuNy43LDAsMCwxLDYuMjcsMGEuNi42LDAsMCwxLC4yNy4wNkEuNjcuNjcsMCwwLDEsNywuNjhMNi42OSwyLjkxSDE5LjgzYS42Ny42NywwLDAsMSwuNjEuMzkuNjguNjgsMCwwLDEtLjA4LjcxbC0xLjg0LDIuM2EuNjUuNjUsMCwwLDEtLjUyLjI1LjY4LjY4LDAsMCwxLS42OC0uNi42NS42NSwwLDAsMSwuMTUtLjVsMS0xLjE5SDZhLjY4LjY4LDAsMCwxLS42Ny0uNjhsLjE4LTEuMjdMMS42OCw1LjY4LDUuNDcsOSw1LjI5LDcuOEEuNjguNjgsMCwwLDEsNiw3LjA4bDEuMzYtLjE1LDAsLjYtLjExLS40Mi4wNi40M2EuMjEuMjEsMCwwLDAtLjE4LjIxQS4yMi4yMiwwLDAsMCw3LjMzLDh2LjFsMCwuNS0uNjItLjA2LjI2LDIuMTNhLjY4LjY4LDAsMCwxLS40MS42NUEuNjYuNjYsMCwwLDEsNi4yNiwxMS4zNVoiLz48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik0xNS4wOSwyMy4yN2EuNTguNTgsMCwwLDEtLjI2LS4wNi42OC42OCwwLDAsMS0uNDEtLjYybC4yNi0yLjI0SDEuNTRBLjcxLjcxLDAsMCwxLC45MiwyMCwuNjkuNjksMCwwLDEsMSwxOS4yNUwyLjg0LDE3YS42Ny42NywwLDAsMSwuNTMtLjI1LjcxLjcxLDAsMCwxLC40Mi4xNC42Ny42NywwLDAsMSwuMjUuNDYuNjkuNjksMCwwLDEtLjE0LjVMMywxOUgxNS4zOWEuNjcuNjcsMCwwLDEsLjY4LjY3TDE1Ljg5LDIxbDMuNzktMy4zN0wxNS45LDE0LjI0bC4xOCwxLjIyYS42OC42OCwwLDAsMS0uNjcuNzJMMTQsMTYuMzRsMC0uNjFoLjA3YS4yMy4yMywwLDAsMCwuMTctLjIyQS4yMi4yMiwwLDAsMCwxNCwxNS4zaDBsMC0uNnYuNWwuMDYtLjQ5LjU5LjA1LS4yNi0yLjEyYS42OS42OSwwLDAsMSwuNDEtLjY2LjU5LjU5LDAsMCwxLC4yNy0uMDUuNjcuNjcsMCwwLDEsLjQ2LjE4bDUuNTgsNWEuNjkuNjksMCwwLDEsLjIyLjQ4LjY2LjY2LDAsMCwxLS4xOS40OGwwLDAsMCwwLTUuNTUsNUEuNjguNjgsMCwwLDEsMTUuMDksMjMuMjdaIi8+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNy4yMSwxNi4zNGEuODMuODMsMCwwLDEtLjc1LS40OEEuODEuODEsMCwwLDEsNi41OCwxNUwxMiw4LjU4SDcuMzJsLS4wNiwwYS44MS44MSwwLDAsMS0uNzMtLjgxLjgyLjgyLDAsMCwxLC43OS0uODJoNi41MWEuODMuODMsMCwwLDEsLjYzLDEuMzZMOSwxNC42OWg1YS44My44MywwLDAsMSwwLDEuNjVINy4yMVoiLz48L3N2Zz4=" /></a>
<p>This is a package designed to run with the <a class="reference external" href="https://zeek.org">Zeek Network Security Monitor</a>. First, <a class="reference external" href="https://zeek.org/get-zeek/">get Zeek</a>. We strive to support both the current feature and LTS releases.</p>
<p>The recommended installation method is via the <a class="reference external" href="https://docs.zeek.org/projects/package-manager/en/stable/">Zeek package manager, zkg</a>. Follow the <a class="reference external" href="https://docs.zeek.org/projects/package-manager/en/stable/quickstart.html">Quickstart guide</a>.</p>
<p>To have Zeek load packages managed by <code class="docutils literal notranslate"><span class="pre">zkg</span></code>, ensure that <code class="docutils literal notranslate"><span class="pre">&#64;load</span> <span class="pre">packages</span></code> is being loaded by Zeek.</p>
</div>
<div class="section" id="writing-filters">
<h2>Writing Filters<a class="headerlink" href="#writing-filters" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Filtering</p>
<p>Let’s say that we only want our <code class="docutils literal notranslate"><span class="pre">ssh.log</span></code> file to have connections where the responder’s port is 22.</p>
<div class="highlight-zeek notranslate"><div class="highlight"><pre><span></span><span class="cp">@ifdef</span> <span class="p">(</span> <span class="n">SSH</span><span class="p">::</span><span class="n">Info</span> <span class="p">)</span>
<span class="kt">hook</span> <span class="nf">pred_hook</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="n">Log</span><span class="p">::</span><span class="n">ID</span><span class="p">,</span> <span class="n">filter_name</span><span class="p">:</span> <span class="kt">string</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="kt">any</span><span class="p">)</span>
  <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">stream</span> <span class="o">!=</span> <span class="n">SSH</span><span class="p">::</span><span class="n">LOG</span> <span class="o">||</span> <span class="n">filter_name</span> <span class="o">!=</span> <span class="s">&quot;default&quot;</span> <span class="p">)</span>
          <span class="k">return</span><span class="p">;</span>

  <span class="kd">local</span> <span class="n">r</span> <span class="o">=</span> <span class="n">rec</span> <span class="ow">as</span> <span class="n">SSH</span><span class="p">::</span><span class="n">Info</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">r</span><span class="o">$</span><span class="n">id</span><span class="o">$</span><span class="n">resp_p</span> <span class="o">!=</span> <span class="m">22/tcp</span> <span class="p">)</span>
          <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">@endif</span>
</pre></div>
</div>
<p>To write a filter, we handle the <code class="docutils literal notranslate"><span class="pre">pred_hook</span></code> hook. Whenever a script calls <code class="docutils literal notranslate"><span class="pre">Log::write</span></code>, the hook fires. If <em>any</em> hook handler execution results in a <code class="docutils literal notranslate"><span class="pre">break</span></code>, the log message is not written. For more information about hooks, see: <a class="reference external" href="https://docs.zeek.org/en/current/script-reference/types.html#type-hook">https://docs.zeek.org/en/current/script-reference/types.html#type-hook</a></p>
<p>Because <code class="docutils literal notranslate"><span class="pre">pred_hook</span></code> is used for <em>all</em> log files, we need to take care to make sure we’re handling the right log messages. Wrapping the filter in an <code class="docutils literal notranslate"><span class="pre">&#64;ifdef</span></code> directive will prevent syntax errors if the base SSH scripts aren’t loaded, for some reason. Using <code class="docutils literal notranslate"><span class="pre">&#64;ifdef</span></code> is preferred, since if we were to load the scripts ourselves, we’d remove the user’s ability to not load those scripts.</p>
<p>Line 4 checks that the message is from the SSH log, and the default filter. The logging framework supports additional filters (see: <a class="reference external" href="https://docs.zeek.org/en/current/frameworks/logging.html">https://docs.zeek.org/en/current/frameworks/logging.html</a> ), this check just ensures that we’re only modifying the behavior of the default <code class="docutils literal notranslate"><span class="pre">ssh.log</span></code> file.</p>
<p>Line 7 converts our info record from <code class="docutils literal notranslate"><span class="pre">any</span></code> type to an <code class="docutils literal notranslate"><span class="pre">SSH::Info</span></code> record, which allows us to access the fields therein. Finally, we check the responder’s port, and break out of the hook if it’s not TCP 22. The break causes the message to not be logged.</p>
</li>
<li><p>Redirecting</p>
<p>Next, let’s say that instead of simply filtering what gets logged, we want to log messages to two different logs: <code class="docutils literal notranslate"><span class="pre">ssh.log</span></code> and <code class="docutils literal notranslate"><span class="pre">ssh_nonstandard_port.log</span></code>. First, we create a new log stream:</p>
<div class="highlight-zeek notranslate"><div class="highlight"><pre><span></span><span class="kn">module</span> <span class="nn">LogFilter</span><span class="p">;</span>

<span class="cp">@ifdef</span> <span class="p">(</span> <span class="n">SSH</span><span class="p">::</span><span class="n">Info</span> <span class="p">)</span>

<span class="k">export</span> <span class="p">{</span>
  <span class="k">redef</span> <span class="kt">enum</span> <span class="nc">Log::ID</span> <span class="o">+=</span> <span class="p">{</span> <span class="n">SshNonStdPort_LOG</span> <span class="p">};</span>
<span class="p">}</span>

<span class="kt">event</span> <span class="nf">LogFilter::initialized</span><span class="p">()</span>
  <span class="p">{</span>
  <span class="nf">Log::create_stream</span><span class="p">(</span><span class="n">SshNonStdPort_LOG</span><span class="p">,</span> <span class="p">[</span><span class="o">$</span><span class="n">columns</span><span class="o">=</span><span class="n">SSH</span><span class="p">::</span><span class="n">Info</span><span class="p">,</span> <span class="o">$</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;ssh_nonstandard_port&quot;</span><span class="p">]);</span>
  <span class="p">}</span>

<span class="cp">@endif</span>
</pre></div>
</div>
<p>Much of this should look familiar from the Zeek logging framework documentation (<a class="reference external" href="https://docs.zeek.org/en/current/frameworks/logging.html#add-a-new-log-file">https://docs.zeek.org/en/current/frameworks/logging.html#add-a-new-log-file</a> ). The difference is that we create the log in the <code class="docutils literal notranslate"><span class="pre">LogFilter::initialized</span></code> event, rather than in <code class="docutils literal notranslate"><span class="pre">zeek_init</span></code>. Once the Log Filter has activated and attached itself to all of the logs, this event fires. This provides an easy way to add a new log, without worrying about the log filter attaching itself multiple times, etc.</p>
<p>Our hook handler also looks familiar:</p>
<div class="highlight-zeek notranslate"><div class="highlight"><pre><span></span><span class="cp">@ifdef</span> <span class="p">(</span> <span class="n">SSH</span><span class="p">::</span><span class="n">Info</span> <span class="p">)</span>
<span class="kt">hook</span> <span class="nf">pred_hook</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="n">Log</span><span class="p">::</span><span class="n">ID</span><span class="p">,</span> <span class="n">filter_name</span><span class="p">:</span> <span class="kt">string</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="kt">any</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">stream</span> <span class="o">!=</span> <span class="n">SSH</span><span class="p">::</span><span class="n">LOG</span> <span class="o">||</span> <span class="n">filter_name</span> <span class="o">!=</span> <span class="s">&quot;default&quot;</span> <span class="p">)</span>
          <span class="k">return</span><span class="p">;</span>

  <span class="kd">local</span> <span class="n">r</span> <span class="o">=</span> <span class="n">rec</span> <span class="ow">as</span> <span class="n">SSH</span><span class="p">::</span><span class="n">Info</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">r</span><span class="o">$</span><span class="n">id</span><span class="o">$</span><span class="n">resp_p</span> <span class="o">!=</span> <span class="m">22/tcp</span> <span class="p">)</span>
          <span class="p">{</span>
          <span class="nf">Log::write</span><span class="p">(</span><span class="n">SshNonStdPort_LOG</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">@endif</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>The only difference is in line 11, where we write the line to our new log file before breaking out of the hook.</p>
</div></blockquote>
<ol class="arabic" start="3">
<li><p>Copying</p>
<p>If in our previous example we omitted the break in line 12, <em>all</em> log lines would be written to <code class="docutils literal notranslate"><span class="pre">ssh.log</span></code>, and only the ones where the server wasn’t running on port 22 would be written to our new log.</p>
</li>
<li><p>Modifying</p>
<p>Log lines can even be modified before they’re written to the log files. Let’s say that instead of version 2, one of our servers actually runs SSH version 9000, and we want to set the field appropriately:</p>
<div class="highlight-zeek notranslate"><div class="highlight"><pre><span></span><span class="cp">@ifdef</span> <span class="p">(</span> <span class="n">SSH</span><span class="p">::</span><span class="n">Info</span> <span class="p">)</span>
<span class="kt">hook</span> <span class="nf">pred_hook</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="n">Log</span><span class="p">::</span><span class="n">ID</span><span class="p">,</span> <span class="n">filter_name</span><span class="p">:</span> <span class="kt">string</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="kt">any</span><span class="p">)</span>
  <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">stream</span> <span class="o">!=</span> <span class="n">SSH</span><span class="p">::</span><span class="n">LOG</span> <span class="o">||</span> <span class="n">filter_name</span> <span class="o">!=</span> <span class="s">&quot;default&quot;</span> <span class="p">)</span>
          <span class="k">return</span><span class="p">;</span>

  <span class="kd">local</span> <span class="n">r</span> <span class="o">=</span> <span class="n">rec</span> <span class="ow">as</span> <span class="n">SSH</span><span class="p">::</span><span class="n">Info</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">r</span><span class="o">$</span><span class="n">id</span><span class="o">$</span><span class="n">resp_h</span> <span class="o">==</span> <span class="m">192.168.1.22</span> <span class="p">)</span>
          <span class="n">r</span><span class="o">$</span><span class="n">version</span> <span class="o">=</span> <span class="mf">9000</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">@endif</span>
</pre></div>
</div>
<p>Note that when modifying log messages like this, we’re only modifying them at the very last second before they get written out. Any policy scripts have already inspected this record.</p>
</li>
</ol>
</div>
<div class="section" id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p>Contributions are welcome! The easiest way to give back is to comment on <a class="reference external" href="https://github.com/esnet-security/logfilter/issues">issues</a> that are important to you – even a quick reaction (thumbs-up/heart/thumbs-down) would help us prioritize issues.</p>
<p>There’s a more in-depth <a class="reference external" href="docs/contributing.rst">contribution guide</a> which lays out some ways that anyone can help.</p>
</div>
<div class="section" id="package-template">
<h2>Package Template<a class="headerlink" href="#package-template" title="Permalink to this headline">¶</a></h2>
<p>This package was created with a <a class="reference external" href="https://github.com/esnet/cookiecutter-zeekpackage">template</a>, using <a class="reference external" href="https://github.com/cruft/cruft">Cruft</a>. A <a class="reference external" href="https://github.com/esnet-security/logfilter/actions?query=workflow%3ACruft">CI job</a> checks for updates to the template. To update the package, simply run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip install -U cruft</span>
<span class="go">cruft update</span>
</pre></div>
</div>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>This project is licensed under the BSD license. See the <a class="reference external" href="./LICENSE">LICENSE</a> file for details.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="scripts/index.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Zeek Package Documentation: Log Filter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, The Regents of the University of California through the Lawrence Berkeley National Laboratory and the International Computer Science Institute

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>